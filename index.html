<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">    <title>Gerenciador de Passagens</title>    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/downloadjs/1.4.8/download.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2196F3;
            --secondary-color: #1976D2;
            --success-color: #4CAF50;
            --background-color: #f5f5f5;
            --text-color: #333;
            --card-background: #ffffff;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.1);
            --transition-speed: 0.3s;
            --border-color: #e0e0e0;
        }

        [data-theme="dark"] {
            --primary-color: #64B5F6;
            --secondary-color: #42A5F5;
            --success-color: #81C784;
            --background-color: #121212;
            --text-color: #e0e0e0;
            --card-background: #1e1e1e;
            --card-shadow: 0 2px 8px rgba(0,0,0,0.3);
            --border-color: #333;
        }

        body {
            font-family: 'Roboto', sans-serif;
            max-width: 1000px;
            margin: 20px auto;
            padding: 20px;
            background-color: var(--background-color);
            color: var(--text-color);
            transition: background-color var(--transition-speed), color var(--transition-speed);
        }

        .container {
            background-color: var(--card-background);
            padding: 30px;
            border-radius: 12px;
            box-shadow: var(--card-shadow);
            transition: transform var(--transition-speed), background-color var(--transition-speed);
        }

        .container:hover {
            transform: translateY(-2px);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 30px;
        }

        .pdf-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .pdf-header h1 {
            margin: 0;
            flex: 1;
            text-align: center;
        }

        .config-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: 20px;
        }

        .config-button:hover {
            background-color: var(--secondary-color);
            transform: rotate(45deg);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #444;
        }

        input[type="date"], input[type="number"], input[type="text"], select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all var(--transition-speed);
        }

        input:focus, select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        button {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 500;
            transition: all var(--transition-speed);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(33, 150, 243, 0.2);
        }

        button i {
            font-size: 1.2em;
        }

        .endereco {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            padding: 15px;
            background-color: #f9f9fa;
            border-radius: 8px;
            margin-bottom: 20px;
            max-width: 1200px; /* Adicione um tamanho máximo para o container */
            margin: 0 auto 20px;
        }

        /* Remove o span de 3 colunas dos dois primeiros campos */
        .endereco .form-group:nth-child(1) {
            grid-column: span 2; /* Nome ocupará 2 colunas */
        }

        .endereco .form-group:nth-child(2) {
            grid-column: span 1; /* CEP ocupará 1 coluna */
        }

        /* Ajuste para o container do CEP */
        .cep-container {
            display: flex;
            gap: 5px;
        }

        .cep-container input {
            flex: 1;
        }

        .cep-container button {
            flex-shrink: 0;
        }

        .transporte-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .transporte-grupo {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
        }

        .transporte-grupo h3 {
            font-size: 1em;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .transporte-grupo .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            background-color: var(--background-color);
            padding: 10px;
            border-radius: 8px;
        }

        .transporte-grupo .header h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 0;
            font-size: 1.1em;
        }

        .config-section {
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
        }

        .config-section button {
            background: none;
            border: none;
            padding: 8px;
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .config-section button i {
            font-size: 1.2em;
        }

        .config-section button:hover {
            color: var(--secondary-color);
            transform: rotate(45deg);
        }

        .config-section button:hover::before {
            content: 'Editar valor da passagem';
            position: absolute;
            right: calc(100% + 5px);
            top: 50%;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.9em;
            white-space: nowrap;
            pointer-events: none;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .badge {
            background-color: var(--primary-color);
            color: white;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.9em;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            margin: 3px;
            transition: all var(--transition-speed);
        }

        .badge i {
            cursor: pointer;
        }

        .badge:hover {
            transform: translateY(-1px);
        }

        .acoes-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .acoes-container button {
            flex: 1;
            justify-content: center;
        }

        button {
            padding: 8px 16px;
        }

        button.btn-small {
            padding: 6px 12px;
            font-size: 0.9em;
        }

        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }

        .transporte-opcao {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .transporte-opcao:hover {
            border-color: var(--primary-color);
            background-color: #f8f9fa;
        }

        .transporte-opcao input[type="checkbox"] {
            margin: 0;
        }

        .transporte-valor {
            color: #666;
            font-size: 0.9em;
        }

        .pdf-table {
            width: 100%;
            margin-top: 20px;
            border: none;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
        }

        .pdf-table th {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            font-weight: 500;
        }

        .pdf-table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
        }

        .pdf-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }

        .valor-total {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.2em;
            box-shadow: var(--card-shadow);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading.active {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .success-animation {
            animation: successPulse 0.5s ease-out;
        }

        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .sequencia-transportes {
            margin-top: 10px;
            min-height: 40px;
            padding: 5px;
            border: 1px dashed #ccc;
            border-radius: 5px;
        }

        .badge {
            display: inline-flex;
            align-items: center;
            background-color: #007bff;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            margin: 3px;
            font-size: 0.9em;
        }

        .badge i {
            margin-left: 5px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .badge i:hover {
            opacity: 1;
        }

        .botoes-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 10px;
        }        .botao-transporte {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            padding: 15px;
            border: none;
            border-radius: 12px;            background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
            color: var(--primary-color);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05),
                       0 4px 15px rgba(33, 150, 243, 0.08);
        }        .botao-transporte:hover {
            background: linear-gradient(145deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            transform: translateY(-2px) scale(1.01);
            box-shadow: 0 8px 25px rgba(33, 150, 243, 0.15),
                       0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .botao-transporte i {
            font-size: 1.5em;
        }

        .botao-transporte span {
            text-align: center;
        }

        .botao-transporte .transporte-valor {
            font-size: 0.9em;
            opacity: 0.8;
            color: inherit;
        }

        .botao-transporte:hover .transporte-valor {
            opacity: 1;
        }

        /* Estilos do modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1001;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.7);
        }

        .modal.active {
            display: block;
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

        .preco-input {
            margin-bottom: 15px;
        }

        .preco-input label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .preco-input input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            transition: all var(--transition-speed);
        }

        .preco-input input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(33, 150, 243, 0.1);
            outline: none;
        }

        /* Fim dos estilos do modal */

        /* Media Queries */
        @media screen and (max-width: 768px) {
    body {
        padding: 10px;
        margin: 10px;
    }

    .container {
        padding: 15px;
    }

    .endereco {
        grid-template-columns: 1fr;
    }

    .endereco .form-group:nth-child(1),
    .endereco .form-group:nth-child(2) {
        grid-column: 1;
    }

    .transporte-container {
        grid-template-columns: 1fr;
    }

    .botoes-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .acoes-container {
        flex-direction: column;
    }

    .acoes-container button {
        width: 100%;
        margin-bottom: 10px;
    }

    .pdf-table {
        display: block;
        overflow-x: auto;
        white-space: nowrap;
    }

    .valor-total {
        flex-direction: column;
        gap: 10px;
        text-align: center;
    }

    .modal-content {
        width: 95%;
        margin: 20px auto;
    }

    h1 {
        font-size: 1.8em;
    }
}

@media screen and (max-width: 480px) {
    .botoes-grid {
        grid-template-columns: 1fr;
    }

    .badge {
        width: 100%;
        margin: 5px 0;
    }

    .pdf-header {
        flex-direction: column;
        text-align: center;
    }

    .config-button {
        margin: 10px auto;
    }

    input[type="date"], 
    input[type="number"], 
    input[type="text"], 
    select {
        font-size: 16px; /* Evita zoom em dispositivos iOS */
    }

    .preco-input {
        margin-bottom: 20px;
    }

    .modal-footer {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .modal-footer button {
        width: 100%;
    }
}

/* Ajustes específicos para tablets */
@media screen and (min-width: 769px) and (max-width: 1024px) {
    .botoes-grid {
        grid-template-columns: repeat(3, 1fr);
    }

    .endereco {
        grid-template-columns: repeat(2, 1fr);
    }
}
    </style>
</head>
<body>
    <div class="loading">
        <div class="spinner"></div>
    </div>

    <div class="container" id="conteudo">        <div class="pdf-header">
            <h1><i class="fas fa-ticket-alt"></i> Gerenciador de Passagens</h1>
        </div>

        <!-- Modal de edição de preços -->
        <div id="modalPrecos" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-money-bill"></i> Configurar Preços</h2>
                    <button class="close-modal" onclick="fecharModalPrecos()">&times;</button>
                </div>
                <div class="preco-input">
                    <label for="precoOnibus">Ônibus (R$):</label>
                    <input type="number" id="precoOnibus" step="0.10" min="0">
                </div>
                <div class="preco-input">
                    <label for="precoTrem">Trem (R$):</label>
                    <input type="number" id="precoTrem" step="0.10" min="0">
                </div>
                <div class="preco-input">
                    <label for="precoMetro">Metrô (R$):</label>
                    <input type="number" id="precoMetro" step="0.10" min="0">
                </div>
                <div class="preco-input">
                    <label for="precoVLT">VLT (R$):</label>
                    <input type="number" id="precoVLT" step="0.10" min="0">
                </div>
                <div class="preco-input">
                    <label for="precoBarcas">CCR Barcas (R$):</label>
                    <input type="number" id="precoBarcas" step="0.10" min="0">
                </div>
                <div class="modal-footer">
                    <button onclick="fecharModalPrecos()">Cancelar</button>
                    <button onclick="salvarPrecos()" style="background-color: var(--success-color);">
                        <i class="fas fa-save"></i> Salvar
                    </button>
                </div>
            </div>
        </div>
        
        <div class="endereco info-pessoal">
            <div class="form-group">
                <label for="nome">Nome Completo:</label>
                <input type="text" id="nome" placeholder="Digite seu nome completo" onchange="salvarInformacoes()">
            </div>
            <div class="form-group">
                <label for="cep">CEP:</label>
                <div class="cep-container">
                    <input type="text" id="cep" placeholder="Digite o CEP" maxlength="9" onkeyup="formatarCEP(this)" onchange="salvarInformacoes()">
                    <button class="btn-small" onclick="buscarCEP()"><i class="fas fa-search"></i></button>
                </div>
            </div>
            <div class="form-group">
                <label for="rua">Rua:</label>
                <input type="text" id="rua" placeholder="Rua" onchange="salvarInformacoes()">
            </div>
            <div class="form-group">
                <label for="numero">Número:</label>
                <input type="text" id="numero" placeholder="Nº" onchange="salvarInformacoes()">
            </div>
            <div class="form-group">
                <label for="bairro">Bairro:</label>
                <input type="text" id="bairro" placeholder="Bairro" onchange="salvarInformacoes()">
            </div>
            <div class="form-group">
                <label for="cidade">Cidade:</label>
                <input type="text" id="cidade" placeholder="Cidade" onchange="salvarInformacoes()">
            </div>
            <div class="form-group">
                <label for="estado">Estado:</label>
                <select id="estado" onchange="salvarInformacoes()">
                    <option value="">Selecione o estado</option>
                    <option value="AC">Acre</option>
                    <option value="AL">Alagoas</option>
                    <option value="AP">Amapá</option>
                    <option value="AM">Amazonas</option>
                    <option value="BA">Bahia</option>
                    <option value="CE">Ceará</option>
                    <option value="DF">Distrito Federal</option>
                    <option value="ES">Espírito Santo</option>
                    <option value="GO">Goiás</option>
                    <option value="MA">Maranhão</option>
                    <option value="MT">Mato Grosso</option>
                    <option value="MS">Mato Grosso do Sul</option>
                    <option value="MG">Minas Gerais</option>
                    <option value="PA">Pará</option>
                    <option value="PB">Paraíba</option>
                    <option value="PR">Paraná</option>
                    <option value="PE">Pernambuco</option>
                    <option value="PI">Piauí</option>
                    <option value="RJ">Rio de Janeiro</option>
                    <option value="RN">Rio Grande do Norte</option>
                    <option value="RS">Rio Grande do Sul</option>
                    <option value="RO">Rondônia</option>
                    <option value="RR">Roraima</option>
                    <option value="SC">Santa Catarina</option>
                    <option value="SP">São Paulo</option>
                    <option value="SE">Sergipe</option>
                    <option value="TO">Tocantins</option>
                </select>
            </div>
        </div>

        <div class="transporte-container">            
            <div class="transporte-grupo">
                <div class="header">
                    <h3><i class="fas fa-arrow-right"></i> Transportes (Ida)</h3>
                    <div class="config-section">
                        <button onclick="abrirModalPrecos()" title="Editar valor da passagem">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="botoes-grid">
                    <button class="botao-transporte" onclick="adicionarTransporteIda('Ônibus', 5.90)">
                        <i class="fas fa-bus"></i>
                        <span>Ônibus</span>
                        <span class="transporte-valor">R$ 5,90</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteIda('Trem', 7.60)">
                        <i class="fas fa-train"></i>
                        <span>Trem</span>
                        <span class="transporte-valor">R$ 7,60</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteIda('Metrô', 7.90)">
                        <i class="fas fa-subway"></i>
                        <span>Metrô</span>
                        <span class="transporte-valor">R$ 7,90</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteIda('VLT', 4.70)">
                        <i class="fas fa-tram"></i>
                        <span>VLT</span>
                        <span class="transporte-valor">R$ 4,70</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteIda('CCR Barcas', 7.70)">
                        <i class="fas fa-ship"></i>
                        <span>CCR Barcas</span>
                        <span class="transporte-valor">R$ 7,70</span>
                    </button>
                </div>
                <div id="sequenciaIda" class="sequencia-transportes"></div>
            </div>            
            <div class="transporte-grupo">
                <div class="header">
                    <h3><i class="fas fa-arrow-left"></i> Transportes (Volta)</h3>
                    <div class="config-section">
                        <button onclick="abrirModalPrecos()" title="Editar valor da passagem">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="botoes-grid">
                    <button class="botao-transporte" onclick="adicionarTransporteVolta('Ônibus', 5.90)">
                        <i class="fas fa-bus"></i>
                        <span>Ônibus</span>
                        <span class="transporte-valor">R$ 5,90</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteVolta('Trem', 7.60)">
                        <i class="fas fa-train"></i>
                        <span>Trem</span>
                        <span class="transporte-valor">R$ 7,60</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteVolta('Metrô', 7.90)">
                        <i class="fas fa-subway"></i>
                        <span>Metrô</span>
                        <span class="transporte-valor">R$ 7,90</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteVolta('VLT', 4.70)">
                        <i class="fas fa-tram"></i>
                        <span>VLT</span>
                        <span class="transporte-valor">R$ 4,70</span>
                    </button>
                    <button class="botao-transporte" onclick="adicionarTransporteVolta('CCR Barcas', 7.70)">
                        <i class="fas fa-ship"></i>
                        <span>CCR Barcas</span>
                        <span class="transporte-valor">R$ 7,70</span>
                    </button>
                </div>
                <div id="sequenciaVolta" class="sequencia-transportes"></div>
            </div>
        </div>

        <div class="form-group">
            <label for="data">Data:</label>
            <input type="date" id="data" required>
        </div>

        <div class="form-group">
            <label for="quantidade">Quantidade de Passagens:</label>
            <input type="number" id="quantidade" min="1" value="1" required>
        </div>

        <div class="acoes-container">
            <button onclick="adicionarRegistro()">
                <i class="fas fa-plus-circle"></i> Adicionar Registro
            </button>
            <button onclick="gerarPDF()" style="background-color: var(--success-color);">
                <i class="fas fa-file-pdf"></i> Gerar PDF
            </button>
        </div>

        <div id="registros">
            <h3>Registros de Passagens</h3>
            <div class="valor-total">
                <span>Total de Passagens: <span id="totalPassagens">0</span></span>
                <span>Valor Total: R$ <span id="valorTotal">0.00</span></span>
            </div>
            <table class="pdf-table">
                <thead>                    <tr>
                        <th>Data</th>
                        <th>Nome</th>
                        <th>Meios de Transporte</th>
                        <th>Dias Trabalhados</th>
                        <th>Valor Ida</th>
                        <th>Valor Volta</th>
                        <th>Total do Dia</th>
                        <th>Ações</th>
                    </tr>
                </thead>
                <tbody id="tabelaRegistros"></tbody>
            </table>
        </div>
    </div>    <script>        let registros = [];
        let ordemSelecaoIda = [];
        let ordemSelecaoVolta = [];
        
        // Preços padrão dos transportes
        let precos = {
            onibus: 5.90,
            trem: 7.60,
            metro: 7.90,
            vlt: 4.70,
            barcas: 7.70
        };

        function adicionarTransporteIda(tipo, valor) {
            const transporte = { tipo: tipo, valor: valor };
            ordemSelecaoIda.push(transporte);
            atualizarSequencia('ida');
        }

        function adicionarTransporteVolta(tipo, valor) {
            const transporte = { tipo: tipo, valor: valor };
            ordemSelecaoVolta.push(transporte);
            atualizarSequencia('volta');
        }

        function atualizarSequencia(tipo) {
            const sequenciaDiv = document.getElementById(tipo === 'ida' ? 'sequenciaIda' : 'sequenciaVolta');
            const ordem = tipo === 'ida' ? ordemSelecaoIda : ordemSelecaoVolta;
            
            sequenciaDiv.innerHTML = '';
            ordem.forEach((transporte, index) => {
                const badge = document.createElement('span');
                badge.className = 'badge';
                badge.innerHTML = `
                    ${index + 1}. ${transporte.tipo} (R$ ${transporte.valor.toFixed(2)})
                    <i class="fas fa-times" onclick="removerTransporte('${tipo}', ${index})"></i>
                `;
                sequenciaDiv.appendChild(badge);
            });
        }

        function removerTransporte(tipo, index) {
            if (tipo === 'ida') {
                ordemSelecaoIda.splice(index, 1);
            } else {
                ordemSelecaoVolta.splice(index, 1);
            }
            atualizarSequencia(tipo);
        }

        // Carrega os preços salvos ao iniciar
        function carregarPrecos() {
            const precosSalvos = localStorage.getItem('precoTransportes');
            if (precosSalvos) {
                precos = JSON.parse(precosSalvos);
                atualizarBotoesTransporte();
            }
        }

        // Salva os preços no localStorage
        function salvarPrecos() {
            precos = {
                onibus: parseFloat(document.getElementById('precoOnibus').value),
                trem: parseFloat(document.getElementById('precoTrem').value),
                metro: parseFloat(document.getElementById('precoMetro').value),
                vlt: parseFloat(document.getElementById('precoVLT').value),
                barcas: parseFloat(document.getElementById('precoBarcas').value)
            };
            localStorage.setItem('precoTransportes', JSON.stringify(precos));
            atualizarBotoesTransporte();
            fecharModalPrecos();
            // Força atualização dos botões após salvar
            setTimeout(atualizarBotoesTransporte, 100);
        }

        // Atualiza os valores nos botões de transporte
        function atualizarBotoesTransporte() {
            atualizarBotaoTransporte('Ônibus', precos.onibus, 'bus');
            atualizarBotaoTransporte('Trem', precos.trem, 'train');
            atualizarBotaoTransporte('Metrô', precos.metro, 'subway');
            atualizarBotaoTransporte('VLT', precos.vlt, 'tram');
            atualizarBotaoTransporte('CCR Barcas', precos.barcas, 'ship');
        }

        function atualizarBotaoTransporte(nome, preco, icone) {
            const botoesIda = document.querySelectorAll('.transporte-grupo:first-child .botao-transporte');
            const botoesVolta = document.querySelectorAll('.transporte-grupo:last-child .botao-transporte');
            
            botoesIda.forEach(botao => {
                if (botao.querySelector('span').textContent === nome) {
                    botao.onclick = () => adicionarTransporteIda(nome, preco);
                    botao.querySelector('.transporte-valor').textContent = `R$ ${preco.toFixed(2)}`;
                }
            });

            botoesVolta.forEach(botao => {
                if (botao.querySelector('span').textContent === nome) {
                    botao.onclick = () => adicionarTransporteVolta(nome, preco);
                    botao.querySelector('.transporte-valor').textContent = `R$ ${preco.toFixed(2)}`;
                }
            });
        }

        function abrirModalPrecos() {
            const modal = document.getElementById('modalPrecos');
            document.getElementById('precoOnibus').value = precos.onibus.toFixed(2);
            document.getElementById('precoTrem').value = precos.trem.toFixed(2);
            document.getElementById('precoMetro').value = precos.metro.toFixed(2);
            document.getElementById('precoVLT').value = precos.vlt.toFixed(2);
            document.getElementById('precoBarcas').value = precos.barcas.toFixed(2);
            modal.style.display = 'block';
        }

        function fecharModalPrecos() {
            const modal = document.getElementById('modalPrecos');
            modal.style.display = 'none';
        }

        // Adicione este código para fechar o modal quando clicar fora dele
        window.onclick = function(event) {
            const modal = document.getElementById('modalPrecos');
            if (event.target == modal) {
                fecharModalPrecos();
            }
        }

        function formatarCEP(input) {
            let valor = input.value.replace(/\D/g, '');
            if (valor.length > 8) valor = valor.substr(0, 8);
            valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
            input.value = valor;
        }

        function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            
            if (cep.length !== 8) {
                alert('Por favor, digite um CEP válido');
                return;
            }

            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (data.erro) {
                        alert('CEP não encontrado');
                        return;
                    }

                    document.getElementById('rua').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('estado').value = data.uf; // Nova linha
                    
                    // Foca no campo número após preencher o endereço
                    document.getElementById('numero').focus();
                    
                    salvarInformacoes();
                })
                .catch(error => {
                    alert('Erro ao buscar o CEP. Tente novamente.');
                });
        }

        function salvarInformacoes() {
            const informacoes = {
                nome: document.getElementById('nome').value,
                cep: document.getElementById('cep').value,
                rua: document.getElementById('rua').value,
                numero: document.getElementById('numero').value,
                bairro: document.getElementById('bairro').value,
                cidade: document.getElementById('cidade').value,
                estado: document.getElementById('estado').value // Nova linha
            };
            localStorage.setItem('informacoesPessoais', JSON.stringify(informacoes));
        }

        function carregarInformacoes() {
            const informacoesSalvas = localStorage.getItem('informacoesPessoais');
            if (informacoesSalvas) {
                const info = JSON.parse(informacoesSalvas);
                document.getElementById('nome').value = info.nome || '';
                document.getElementById('cep').value = info.cep || '';
                document.getElementById('rua').value = info.rua || '';
                document.getElementById('numero').value = info.numero || '';
                document.getElementById('bairro').value = info.bairro || '';
                document.getElementById('cidade').value = info.cidade || '';
                document.getElementById('estado').value = info.estado || ''; // Nova linha
            }
        }        function mostrarLoading() {
            document.querySelector('.loading').classList.add('active');
        }

        function ocultarLoading() {
            document.querySelector('.loading').classList.remove('active');
        }        function adicionarRegistro() {
            try {
                // Validação da data
                const data = document.getElementById('data').value;
                if (!data) {
                    alert('Por favor, selecione uma data!');
                    document.getElementById('data').focus();
                    return;
                }

                // Validação da quantidade
                const quantidadeStr = document.getElementById('quantidade').value;
                const quantidade = parseInt(quantidadeStr);
                if (isNaN(quantidade) || quantidade < 1) {
                    alert('Por favor, insira uma quantidade válida maior que zero!');
                    document.getElementById('quantidade').focus();
                    return;
                }

                if (ordemSelecaoIda.length === 0) {
                    alert('Por favor, selecione pelo menos um transporte de ida!');
                    return;
                }

                if (ordemSelecaoVolta.length === 0) {
                    alert('Por favor, selecione pelo menos um transporte de volta!');
                    return;
                }

                // Cálculo dos valores
                const valorTotalIda = ordemSelecaoIda.reduce((total, t) => total + t.valor, 0);
                const valorTotalVolta = ordemSelecaoVolta.reduce((total, t) => total + t.valor, 0);

                // Criação do registro
                const registro = {
                    data: data,
                    quantidade: quantidade,
                    transportesIda: [...ordemSelecaoIda],
                    transportesVolta: [...ordemSelecaoVolta],
                    valorTotalIda: valorTotalIda,
                    valorTotalVolta: valorTotalVolta,
                    totalDia: (valorTotalIda + valorTotalVolta) * quantidade
                };

                // Adiciona o registro e atualiza a interface
                registros.push(registro);
                atualizarTabela();
                salvarRegistros();

                // Limpa os campos após adicionar
                document.getElementById('data').value = '';
                document.getElementById('quantidade').value = '1';
                ordemSelecaoIda = [];
                ordemSelecaoVolta = [];
                atualizarSequencia('ida');
                atualizarSequencia('volta');

                // Animação de sucesso
                const container = document.querySelector('.container');
                container.classList.add('success-animation');
                setTimeout(() => container.classList.remove('success-animation'), 500);

                alert('Registro adicionado com sucesso!');
            } catch (error) {
                alert('Erro ao adicionar registro: ' + error.message);
                console.error('Erro ao adicionar registro:', error);
            }
        }

        function removerRegistro(index) {
            registros.splice(index, 1);
            atualizarTabela();
            salvarRegistros();
        }        function formatarData(dataStr) {
            const [ano, mes, dia] = dataStr.split('-');
            return `${dia}/${mes}/${ano}`;
        }

        function atualizarTabela() {
            try {
                const tbody = document.getElementById('tabelaRegistros');
                const totalElement = document.getElementById('totalPassagens');
                const valorTotalElement = document.getElementById('valorTotal');
                const nome = document.getElementById('nome').value || 'Não informado';
                let totalPassagens = 0;
                let valorTotal = 0;

                tbody.innerHTML = '';
                
                registros.forEach((registro, index) => {
                    const tr = document.createElement('tr');
                    const dataFormatada = formatarData(registro.data);
                    
                    const transportesIdaText = registro.transportesIda
                        .map(t => t.tipo)
                        .join(' → ');

                    const transportesVoltaText = registro.transportesVolta
                        .map(t => t.tipo)
                        .join(' → ');
                    
                    tr.innerHTML = `
                        <td>${dataFormatada}</td>
                        <td>${nome}</td>
                        <td>
                            <strong>Ida:</strong> ${transportesIdaText}<br>
                            <strong>Volta:</strong> ${transportesVoltaText}
                        </td>
                        <td>${registro.quantidade}</td>
                        <td>R$ ${registro.valorTotalIda.toFixed(2)}</td>
                        <td>R$ ${registro.valorTotalVolta.toFixed(2)}</td>
                        <td>R$ ${registro.totalDia.toFixed(2)}</td>
                        <td>
                            <button onclick="removerRegistro(${index})" style="padding: 8px;" title="Remover registro">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    
                    tbody.appendChild(tr);
                    totalPassagens += registro.quantidade;
                    valorTotal += registro.totalDia;
                });

                totalElement.textContent = totalPassagens;
                valorTotalElement.textContent = valorTotal.toFixed(2);
            } catch (error) {
                console.error('Erro ao atualizar tabela:', error);
                alert('Ocorreu um erro ao atualizar a tabela. Por favor, tente novamente.');
            }
        }

        function salvarRegistros() {
            localStorage.setItem('registrosPassagens', JSON.stringify(registros));
        }

        function carregarRegistros() {
            const dadosSalvos = localStorage.getItem('registrosPassagens');
            if (dadosSalvos) {
                registros = JSON.parse(dadosSalvos);
                atualizarTabela();
            }
        }        async function gerarPDF() {
            try {
                mostrarLoading();
                const { jsPDF } = window.jspdf;
                
                // Criar PDF no formato paisagem
                const pdf = new jsPDF({
                    orientation: 'landscape',
                    unit: 'mm',
                    format: 'a4'
                });

                const nome = document.getElementById('nome').value || 'Não informado';
                const data = new Date().toLocaleDateString('pt-BR');
                const endereco = document.getElementById('rua').value;
                const numero = document.getElementById('numero').value;
                const bairro = document.getElementById('bairro').value;
                const cidade = document.getElementById('cidade').value;
                const estado = document.getElementById('estado').value;

                // Adiciona cabeçalho com informações pessoais
                pdf.setFontSize(16);
                pdf.text('Relatório de Controle de Vale Transporte', pdf.internal.pageSize.getWidth() / 2, 15, { align: 'center' });
                pdf.setFontSize(10);
                pdf.text(`Nome: ${nome}`, 14, 25);
                pdf.text(`Endereço: ${endereco}, ${numero} - ${bairro} - ${cidade}/${estado}`, 14, 30);

                // Prepara os dados para a tabela
                const dados = registros.map(registro => {
                    const transportesIdaText = registro.transportesIda
                        .map(t => t.tipo)
                        .join(' → ');
                    const transportesVoltaText = registro.transportesVolta
                        .map(t => t.tipo)
                        .join(' → ');

                    return [
                        formatarData(registro.data),
                        transportesIdaText,
                        `R$ ${registro.valorTotalIda.toFixed(2)}`,
                        transportesVoltaText,
                        `R$ ${registro.valorTotalVolta.toFixed(2)}`,
                        registro.quantidade,
                        `R$ ${registro.totalDia.toFixed(2)}`
                    ];
                });

                // Calcula totais
                const totalPassagens = registros.reduce((total, reg) => total + reg.quantidade, 0);
                const valorTotal = registros.reduce((total, reg) => total + reg.totalDia, 0);                // Configuração da tabela
                const pageWidth = pdf.internal.pageSize.getWidth();
                pdf.autoTable({
                    startY: 40,
                    margin: { left: 10, right: 10 },
                    head: [[
                        'Data',
                        'Transportes (Ida)',
                        'Valor Ida',
                        'Transportes (Volta)',
                        'Valor Volta',
                        'Qtd.',
                        'Total Dia'
                    ]],
                    body: dados,
                    foot: [[
                        'TOTAL',
                        '',
                        '',
                        '',
                        '',
                        totalPassagens,
                        `R$ ${valorTotal.toFixed(2)}`
                    ]],
                    theme: 'grid',
                    headStyles: {
                        fillColor: [33, 150, 243],
                        textColor: 255,
                        fontSize: 10,
                        halign: 'center',
                        fontStyle: 'bold'
                    },
                    bodyStyles: {
                        fontSize: 9,
                        halign: 'center'
                    },
                    footStyles: {
                        fillColor: [33, 150, 243],
                        textColor: 255,
                        fontSize: 10,
                        fontStyle: 'bold'
                    },
                    styles: {
                        cellPadding: 3,
                        valign: 'middle'
                    },                    columnStyles: {
                        0: { cellWidth: 30 },  // Data
                        1: { cellWidth: 60 },  // Transportes Ida
                        2: { cellWidth: 30 },  // Valor Ida
                        3: { cellWidth: 60 },  // Transportes Volta
                        4: { cellWidth: 30 },  // Valor Volta
                        5: { cellWidth: 20 },  // Quantidade
                        6: { cellWidth: 35 }   // Total
                    },
                    alternateRowStyles: {
                        fillColor: [245, 245, 245]
                    },
                    didDrawPage: function(data) {
                        // Adiciona número de página em cada página
                        pdf.setFontSize(8);
                        pdf.text(
                            `Página ${data.pageNumber} de ${pdf.internal.getNumberOfPages()}`,
                            pdf.internal.pageSize.getWidth() - 20,
                            pdf.internal.pageSize.getHeight() - 10,
                            { align: 'right' }
                        );
                    }
                });

                // Gera o arquivo PDF
                const pdfOutput = pdf.output('blob');
                
                // Usa a biblioteca download.js para fazer o download
                const nomeArquivo = `controle-passagens-${nome.replace(/[^a-zA-Z0-9]/g, '_')}.pdf`;
                download(pdfOutput, nomeArquivo, "application/pdf");
                
                ocultarLoading();
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Ocorreu um erro ao gerar o PDF. Por favor, tente novamente.');
                ocultarLoading();
            }
        }

        // Event listeners para melhorar a UX
        document.querySelectorAll('input, select').forEach(element => {
            element.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    if (element.id === 'transporteIda') adicionarTransporte('ida');
                    else if (element.id === 'transporteVolta') adicionarTransporte('volta');
                    else if (element.id === 'data' || element.id === 'quantidade') adicionarRegistro();
                }
            });
        });

        document.addEventListener('DOMContentLoaded', function() {
    // Fecha o teclado virtual ao pressionar enter
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                input.blur();
            }
        });
    });

    // Melhora o scroll em dispositivos iOS
    document.querySelectorAll('.pdf-table').forEach(table => {
        table.addEventListener('touchmove', function(e) {
            e.stopPropagation();
        });
    });
});
        // Carrega os registros quando a página é aberta
        carregarRegistros();
        carregarInformacoes();
        carregarPrecos();
    </script>
</body>
</html>
